---
title: |
  Supplementary Material (Not for Publication):
  "Adding Nudge-based Reminders to Financial Incentives for Promoting Antibody Testing and Vaccination to Prevent the Spread of Rubella"
author:
  - name: Hiroki Kato
    inst-id: a
  - name: Shusaku Sasaki
    inst-id: b
  - name: Fumio Ohtake
    inst-id: b
inst:
  - id: a
    name: Graduate School of Economics, Osaka University
  - id: b
    name: Center for Infectious Disease Education and Research (CiDER), Osaka University
biblio-style: agsm
bibliography: text-message-2020RCT.bib
output:
  bookdown::pdf_document2:
    latex_engine: pdflatex
    template: template/my-template.tex
    keep_tex: true
    citation_package: natbib
    toc: true
base-strech: 1.5
header-includes:
  - \makeatletter
  - \@addtoreset{table}{section}
  - \@addtoreset{figure}{section}
  - \makeatother
  - \renewcommand\thetable{\thesection\arabic{table}}
  - \renewcommand\thefigure{\thesection\arabic{figure}}
---

```{r chunk-option, include=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  warning = FALSE,
  error = FALSE,
  message = FALSE,
  dev = "pdf",
  fig.width = 15,
  fig.height = 8,
  fig.pos = "t",
  out.extra = ""
)
```

```{r define-class}
library(here)
source(here("R/R6_StartAnalysis.r"))

options(
  knitr.table.format = "latex",
  knitr.kable.NA = "",
  modelsummary_stars_note = FALSE,
  modelsummary_factory_default = "latex"
)
```

```{r setup}
ctrl <- c(
  "age", "married", "education",
  "income", "noinfo_income",
  "exercise_w1", "health_check", "flushot", "norm_waiting_line", "selfish_anonymous",
  "handwash", "temp_check", "avoid_out", "avoid_crowd", "wear_mask"
)

setup <- StartAnalysis$new(here("data/online_survey.csv"))
setup$add_control(ctrl)
main <- setup$main()
```

# RDD

```{r rdd-int}
est <- main$wave1 %>%
  dplyr::filter(age %in% 46:47) %>%
  group_by(nudge) %>%
  nest() %>%
  ungroup() %>%
  mutate(
    test = map(
      data,
      ~ lm_robust(outcome_test ~ coupon2019, data = ., se_type = "stata")
    ),
    vacc = map(
      data,
      ~ lm_robust(outcome_vacc ~ coupon2019, data = ., se_type = "stata")
    )
  ) %>%
  mutate(
    test_tidy = map(test, broom::tidy),
    test_glan = map(test, broom::glance),
    test_coef = map_dbl(test_tidy, ~ .[2, "estimate"]),
    test_se = map_dbl(test_tidy, ~ .[2, "std.error"]),
    test_p = map_dbl(test_tidy, ~ .[2, "p.value"]),
    test_n = map_int(test_glan, ~ .[1, "nobs"]),
    vacc_tidy = map(vacc, broom::tidy),
    vacc_glan = map(vacc, broom::glance),
    vacc_coef = map_dbl(vacc_tidy, ~ .[2, "estimate"]),
    vacc_se = map_dbl(vacc_tidy, ~ .[2, "std.error"]),
    vacc_p = map_dbl(vacc_tidy, ~ .[2, "p.value"]),
    vacc_n = map_int(vacc_glan, ~ .[1, "nobs"])
  ) %>%
  select(nudge, test_coef:test_n, vacc_coef:vacc_n)

nudge_labels <- c(
  "MHLW (Control)",
  "MHLW (Age)",
  "Altruistic",
  "Selfish",
  "Social Comparison",
  "Deadline",
  "Convenient"
)

est %>%
  arrange(nudge) %>%
  mutate(nudge = factor(nudge, levels = LETTERS[1:7], labels = nudge_labels)) %>%
  knitr::kable(
    caption = "Effect of Default Incentive on Intentions near Threshold",
    col.names = c("Group", rep(c("Est", "SE", "P", "N"), 2)),
    digits = 3,
    align = "lcccccccc",
    booktabs = TRUE,
    linesep = ""
  ) %>%
  kableExtra::kable_styling(font_size = 10) %>%
  kableExtra::add_header_above(c(" " = 1, "Testing" = 4, "Vaccination" = 4)) %>%
  kableExtra::footnote(
    general_title = "",
    general = "Notes: We use respondents whose age is 46 or 47 years old.",
    threeparttable = TRUE,
    escape = FALSE
  )
```